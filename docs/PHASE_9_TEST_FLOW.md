# Phase 9 Feature Flag 테스트 Flow

## 🎯 테스트 목표

Facebook UI Feature Flag이 정상적으로 작동하는지 검증

---

## 📋 테스트 시나리오

### 시나리오 1: Facebook UI 활성화 상태 테스트 (`NEXT_PUBLIC_USE_FACEBOOK_UI=true`)

#### 1-1. 환경 설정 확인

- [ ] `.env.local` 파일에서 `NEXT_PUBLIC_USE_FACEBOOK_UI=true` 확인
- [ ] 서비스 재시작 (`./kill-services.sh` → `./start-services.sh`)

#### 1-2. 웹 페이지 로드

- [ ] http://localhost:3000 접속
- [ ] 홈페이지 정상 로드 확인

#### 1-3. 로그인

- [ ] 상단 우측 "로그인" 버튼 클릭
- [ ] 테스트 계정 로그인
  - 이메일: `user1@example.com`
  - 비밀번호: `test123456`
- [ ] 로그인 성공 확인 (프로필 버튼 표시)

#### 1-4. 질문 상세 페이지 접속

- [ ] 홈페이지의 질문 목록에서 아무 질문 클릭
- [ ] 또는 직접 URL 접속: `/questions/[question-id]`

#### 1-5. 답변 섹션 검증

- [ ] "답변 N개" 섹션이 표시되는지 확인
- [ ] **Facebook UI 컴포넌트 확인**:
  - [ ] `FacebookAnswerThread` 컴포넌트가 렌더링되었는지 확인
  - [ ] 다음 UI 요소들이 Facebook 스타일로 표시되는지 확인:
    - 답변 리스트 (Facebook 스타일 카드)
    - 좋아요/싫어요 버튼 (Facebook 스타일)
    - 댓글 스레드 (계층형 댓글)
    - 답변 작성 폼

#### 1-6. 상호작용 테스트

- [ ] 답변에 좋아요 클릭 → 좋아요 수 증가 확인
- [ ] 답변에 싫어요 클릭 → 싫어요 수 증가 확인
- [ ] 댓글 작성 가능한지 확인
- [ ] 댓글이 계층형으로 표시되는지 확인

---

### 시나리오 2: Facebook UI 비활성화 상태 테스트 (`NEXT_PUBLIC_USE_FACEBOOK_UI=false`)

#### 2-1. 환경 설정 변경

- [ ] `.env.local` 파일 수정: `NEXT_PUBLIC_USE_FACEBOOK_UI=false`
- [ ] 서비스 재시작 (`./kill-services.sh` → `./start-services.sh`)

#### 2-2. 웹 페이지 로드

- [ ] http://localhost:3000 접속
- [ ] 홈페이지 정상 로드 확인

#### 2-3. 로그인

- [ ] 동일하게 로그인 진행

#### 2-4. 질문 상세 페이지 접속

- [ ] 동일한 질문 페이지 접속

#### 2-5. 답변 섹션 검증

- [ ] **폴백 UI 확인**:
  - [ ] "기존 답변 시스템입니다." 메시지가 표시되는지 확인
  - [ ] Facebook UI 컴포넌트가 렌더링되지 않는지 확인

#### 2-6. 페이지 정상성 검증

- [ ] 페이지에 에러가 없는지 확인 (브라우저 콘솔)
- [ ] 다른 기능들이 정상 작동하는지 확인

---

### 시나리오 3: 로그아웃 상태 테스트

#### 3-1. 로그아웃

- [ ] 프로필 메뉴에서 "로그아웃" 클릭
- [ ] 로그아웃 성공 확인

#### 3-2. 질문 상세 페이지 재접속

- [ ] 동일한 질문 페이지 접속

#### 3-3. 답변 섹션 검증

- [ ] "답변을 작성하려면 로그인이 필요합니다" 메시지 표시 확인
- [ ] "로그인하기" 버튼이 표시되는지 확인
- [ ] `useFacebookUI` 값과 관계없이 로그인 필요 메시지가 표시되는지 확인

---

## 🔍 개발자 도구 검증

### 콘솔 확인

```javascript
// 브라우저 콘솔에서 확인 가능한 것들:
// 1. 에러/경고 메시지 없는지 확인
// 2. React Hook 에러 없는지 확인
```

### 네트워크 확인

- [ ] API 요청들이 정상적으로 응답하는지 확인 (200 상태코드)
  - `/api/questions/[id]` - 질문 정보
  - `/api/questions/[id]/answers` - 답변 목록

### 소스 코드 확인

- [ ] 개발자 도구 → Sources에서 `useNewFacebookUI` 훅이 import되어 있는지 확인

---

## 📊 테스트 결과 기록

### 테스트 환경

- 브라우저: Chrome/Safari/Firefox
- OS: macOS
- Next.js: 14.2.33
- API 서버: 포트 4000
- Web 서버: 포트 3000

### 테스트 결과 요약

| 시나리오                      | 상태 | 노트 |
| ----------------------------- | ---- | ---- |
| 1-1. 환경 설정 확인           | ☐    |      |
| 1-2. 웹 페이지 로드           | ☐    |      |
| 1-3. 로그인                   | ☐    |      |
| 1-4. 질문 상세 페이지         | ☐    |      |
| 1-5. Facebook UI 렌더링       | ☐    |      |
| 1-6. 상호작용 테스트          | ☐    |      |
| 2-1. 환경 설정 변경           | ☐    |      |
| 2-2~2-6. 폴백 UI 테스트       | ☐    |      |
| 3-1~3-3. 로그아웃 상태 테스트 | ☐    |      |

---

## 🚀 Phase 9 Step 3 완료 체크리스트

### 코드 구현

- [x] `useNewFacebookUI` 훅 생성
- [x] `.env.local`에 `NEXT_PUBLIC_USE_FACEBOOK_UI=true` 설정
- [x] 질문 상세 페이지에 훅 import
- [x] 조건부 렌더링 로직 추가 (Facebook UI vs 폴백)
- [x] React Hooks 규칙 준수 (훅을 컴포넌트 최상단에서 호출)

### 타입 체크

- [x] TypeScript 컴파일 성공

### 리뷰

- [ ] 모든 테스트 시나리오 통과
- [ ] 에러/경고 없음
- [ ] 문서 업데이트 완료

---

## 📝 다음 단계

**Phase 9 Step 4**: 단위 테스트 작성

- `useNewFacebookUI.test.ts` 작성
- 환경 변수 mocking
- 반환 값 검증

**Phase 9 Step 5**: 통합 테스트

- E2E 테스트 작성
- Facebook UI vs 폴백 UI 동시 검증

**Phase 9 Step 6**: 커밋 및 배포

```bash
git add .
git commit -m "feat: Feature flag 기반 Facebook UI 마이그레이션 - Step 3 완료"
```

---

## 💡 문제 해결 가이드

### 문제: Facebook UI가 표시되지 않음

**원인**: 환경 변수가 빌드 타임에 결정됨
**해결**: 서비스 재시작 필수

### 문제: "기존 답변 시스템입니다" 메시지만 표시됨

**확인사항**:

- [ ] `.env.local`에서 `NEXT_PUBLIC_USE_FACEBOOK_UI=true`인지 확인
- [ ] 웹 서버를 완전히 재시작했는지 확인
- [ ] 브라우저 캐시를 삭제했는지 확인

### 문제: React Hook 에러

**원인**: 훅이 콜백 함수 내부에서 호출됨
**확인사항**:

- [ ] `useNewFacebookUI()` 호출이 컴포넌트 최상단에 있는지 확인
- [ ] 조건부 렌더링이 훅 호출 후 JSX에서만 사용되는지 확인
