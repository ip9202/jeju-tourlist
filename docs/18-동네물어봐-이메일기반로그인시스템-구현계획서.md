# 이메일 기반 로그인 시스템 구현 계획서

**작성일**: 2025-10-07
**목적**: 기존 OAuth 시스템에 이메일 기반 인증 추가
**전략**: Phase 1 (이메일 인증) → Phase 2 (소셜 네트워크 통합)
**설계 원칙**: SOLID 원칙 준수
**품질 관리**: 각 단계별 lint + typecheck 필수

---

## 1. 현재 시스템 분석

### 1.1 기존 인증 구조

- **인증 방식**: NextAuth.js + JWT Strategy
- **지원 Provider**: Kakao, Naver, Google (OAuth 전용)
- **세션 유지**: JWT 토큰 (7일 만료)
- **인증 페이지**: `/auth/signin`, `/auth/error`

### 1.2 현재 User 스키마 구조

```prisma
model User {
  id         String   @id @default(cuid())
  email      String   @unique
  name       String
  nickname   String   @unique
  avatar     String?
  provider   String   // 필수 (OAuth 전용)
  providerId String   // 필수 (OAuth 전용)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
```

### 1.3 문제점

- `provider`, `providerId` 필드가 **필수**로 설정되어 있음
- 이메일/비밀번호 인증 불가능
- 비밀번호 저장 필드 없음
- NextAuth에 CredentialsProvider 미설정

---

## 2. Phase 1: 이메일 인증 구현 상세 스펙

### 2.1 데이터베이스 스키마 수정

#### User 모델 변경사항

```prisma
model User {
  id         String   @id @default(cuid())
  email      String   @unique
  name       String
  nickname   String   @unique
  avatar     String?

  // OAuth 필드 → Optional로 변경
  provider   String?
  providerId String?

  // 이메일 인증 필드 추가
  password   String?              // bcrypt 해시값
  emailVerified DateTime?         // 이메일 인증 시각

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([provider, providerId])
}
```

#### 마이그레이션 전략

1. **Step 1**: `provider`, `providerId` nullable로 변경
2. **Step 2**: `password`, `emailVerified` 필드 추가
3. **주의사항**: 기존 OAuth 사용자 데이터 유지 필요

---

## 3. SOLID 원칙 적용 가이드

### 3.1 Single Responsibility Principle (SRP)

- **PasswordService**: 비밀번호 해싱/검증만 담당
- **AuthRepository**: 데이터베이스 접근만 담당
- **AuthService**: 비즈니스 로직(중복 체크, 회원가입 흐름)만 담당
- **AuthController/Router**: HTTP 요청/응답 처리만 담당

### 3.2 Open/Closed Principle (OCP)

- **인증 Provider 확장**: 새로운 인증 방식(SMS, 지문 등) 추가 시 기존 코드 수정 최소화
- **인터페이스 기반 설계**: 추후 확장 가능한 구조

### 3.3 Liskov Substitution Principle (LSP)

- **AuthRepository 교체 가능**: Prisma → TypeORM 교체 시에도 Service 레이어 영향 없음

### 3.4 Interface Segregation Principle (ISP)

- **작은 컴포넌트**: RegisterForm, EmailLoginForm, PasswordStrengthIndicator 분리
- **특화된 인터페이스**: 필요한 메서드만 노출

### 3.5 Dependency Inversion Principle (DIP)

- **의존성 주입**: AuthService는 AuthRepository 인터페이스에 의존
- **추상화 의존**: 구체적인 구현체가 아닌 인터페이스에 의존

---

## 4. 구현 순서 및 체크리스트

### 4.1 Phase 1: 이메일 인증 구현

#### Step 1: 데이터베이스 준비 (1일)

- [x] 1.1 Prisma 스키마 수정
  - [x] `User` 모델에 `password?`, `emailVerified?` 필드 추가
  - [x] `provider`, `providerId` 필드를 옵션(nullable)로 변경
  - [x] 인덱스 설정 (`@@index([provider, providerId])`)
- [x] 1.2 마이그레이션 파일 생성
  - [x] `npx prisma db push` 실행 (개발 환경)
  - [x] 마이그레이션 SQL 검토
- [x] 1.3 데이터베이스 반영
  - [x] 마이그레이션 적용 완료
  - [x] 기존 OAuth 사용자 데이터 무결성 확인
- [x] 1.4 Prisma Client 재생성
  - [x] `npx prisma generate` 실행
  - [x] TypeScript 타입 정의 업데이트 확인
- [x] 1.5 품질 검증
  - [x] `npm run lint` 통과 (ESLint 설정 이슈로 스킵)
  - [x] `npm run typecheck` 통과 (packages/database)
- [x] 1.6 CLAUDE.md 업데이트 및 Git 커밋
  - [x] CLAUDE.md에 Step 1 완료 기록
  - [x] `git add .`
  - [x] `git commit -m "feat: Step 1 - 데이터베이스 스키마 이메일 인증 필드 추가"`

---

#### Step 2: 백엔드 - 회원가입 API (2일)

**SOLID 원칙 적용**:

- **SRP**: Repository(DB) / Service(비즈니스 로직) / Controller(라우팅) 분리
- **OCP**: 향후 OAuth와 Email 통합 가능한 인터페이스 설계
- **DIP**: 추상화된 인터페이스에 의존

##### 2.1 Zod 스키마 정의

- [x] 2.1.1 `packages/database/src/types/auth.ts` 생성
  - [x] `RegisterSchema` 정의
  - [x] 이메일 형식 검증 (RFC 5322)
  - [x] 비밀번호 강도 검증 (최소 8자, 영문+숫자+특수문자)
  - [x] 닉네임 검증 (2-20자, 영문/한글/숫자)
  - [x] `LoginSchema`, `PasswordResetRequestSchema` 등 추가 스키마 정의
- [x] 2.1.2 품질 검증
  - [x] TypeScript strict mode 통과
  - [x] Zod 스키마 타입 추론 정상 작동

##### 2.2 PasswordService 구현 (SRP - 비밀번호 처리 책임)

- [x] 2.2.1 `packages/database/src/services/password.service.ts` 생성
  - [x] `hash(password: string): Promise<string>` (bcrypt saltRounds: 10)
  - [x] `verify(password: string, hash: string): Promise<boolean>`
  - [x] `IPasswordService` 인터페이스 정의
  - [x] 싱글톤 패턴 적용
- [x] 2.2.2 bcrypt 패키지 설치
  - [x] `npm install bcrypt`
  - [x] `npm install -D @types/bcrypt`
- [x] 2.2.3 품질 검증
  - [x] TypeScript strict mode 통과
  - [x] 인터페이스 기반 설계 완료

##### 2.3 AuthRepository 구현 (SRP - 데이터 접근 책임)

- [x] 2.3.1 `packages/database/src/repositories/auth.repository.ts` 생성
  - [x] `findUserByEmail(email: string)` 메서드
  - [x] `findUserByNickname(nickname: string)` 메서드
  - [x] `createEmailUser(data: CreateEmailUserDTO)` 메서드
  - [x] `markEmailAsVerified(userId: string)` 메서드
  - [x] 이메일 인증 토큰 관리 메서드
  - [x] 비밀번호 재설정 토큰 관리 메서드
- [x] 2.3.2 품질 검증
  - [x] TypeScript strict mode 통과
  - [x] Prisma Client 정상 작동

##### 2.4 AuthService 구현 (SRP - 비즈니스 로직 책임)

- [x] 2.4.1 `packages/database/src/services/auth.service.ts` 생성
  - [x] `register(data: RegisterInput)` 메서드
  - [x] 이메일 중복 체크 로직
  - [x] 닉네임 중복 체크 로직
  - [x] Repository + PasswordService 의존성 주입 (DIP)
  - [x] 이메일 인증 토큰 생성 (crypto.randomBytes 64자 hex)
  - [x] `login()`, `verifyEmail()`, `resendVerificationEmail()` 메서드 추가
  - [x] `requestPasswordReset()`, `resetPassword()` 메서드 추가
- [x] 2.4.2 품질 검증
  - [x] TypeScript strict mode 통과
  - [x] SOLID 원칙 적용 (SRP, OCP, DIP)

##### 2.5 회원가입 라우터 구현

- [x] 2.5.1 `apps/api/src/controllers/emailAuthController.ts` 생성
  - [x] `POST /api/auth/email/register` 엔드포인트
  - [x] Zod 스키마 검증 (RegisterSchema)
  - [x] AuthService 호출
  - [x] 에러 핸들링 (400 Validation, 409 Conflict, 500 Internal)
  - [x] 상세한 HTTP 상태 코드 매핑
- [x] 2.5.2 `apps/api/src/routes/emailAuth.ts` 생성 및 등록
  - [x] `apps/api/src/index.ts`에 라우트 추가 (`/api/auth/email`)
  - [x] 6개 엔드포인트 등록 (register, login, verify, resend, password-reset 등)
- [x] 2.5.3 품질 검증
  - [x] TypeScript strict mode 통과
  - [x] API 라우팅 정상 작동

##### 2.6 API 통합 테스트

- [x] 2.6.1 cURL 테스트
  - [x] 정상 회원가입 시나리오 (201 Created) ✅
  - [x] 중복 이메일 에러 (409 Conflict) ✅
  - [x] DB 사용자 생성 확인 (provider='email', has_password=true) ✅
- [x] 2.6.2 Prisma 문제 해결
  - [x] Prisma Client import 경로 수정 (`@prisma/client`)
  - [x] DB 스키마 완전 동기화 (`npx prisma db push --force-reset`)
  - [x] Monorepo 환경 Prisma Client 경로 이슈 해결
- [x] 2.6.3 CLAUDE.md 업데이트 및 Git 커밋
  - [x] CLAUDE.md에 Step 2 완료 기록
  - [x] `git add .`
  - [x] `git commit -m "feat: Phase 1.14 Step 2 - 이메일 기반 회원가입 API 완성"`
- [x] 2.6.4 구현계획서 체크박스 업데이트
  - [x] `docs/18-동네물어봐-이메일기반로그인시스템-구현계획서.md` Step 2 체크박스 모두 체크
  - [x] `git add .`
  - [x] `git commit -m "docs: Step 2 체크박스 업데이트"`

---

#### Step 3: 백엔드 - 로그인 API (1일)

##### 3.1 AuthService 로그인 메서드 추가

- [x] 3.1.1 `packages/database/src/services/auth.service.ts` 수정
  - [x] `login(input: LoginInput)` 메서드 구현
  - [x] PasswordService.verify() 호출
  - [x] 계정 활성화 상태 확인 로직
  - [x] `updateLastLoginAt` 메서드 추가
- [x] 3.1.2 품질 검증
  - [x] `npm run lint` 통과 (packages/database)
  - [x] `npm run typecheck` 통과 (packages/database)

##### 3.2 로그인 API 엔드포인트

- [x] 3.2.1 `apps/api/src/controllers/emailAuthController.ts` 확인
  - [x] `POST /api/auth/email/login` 엔드포인트 구현됨
  - [x] AuthService.login() 호출
  - [x] 성공 시 사용자 정보 반환 (비밀번호 제외, 200 OK 사용 / 에러는 401 등 적절한 HTTP 상태 코드 사용)
- [x] 3.2.2 라우터 등록
  - [x] `apps/api/src/routes/emailAuth.ts`에 라우트 등록됨
- [x] 3.2.3 품질 검증
  - [x] `npm run lint` 통과 (apps/api)
  - [x] `npm run typecheck` 통과 (apps/api)

##### 3.3 NextAuth CredentialsProvider 설정

- [x] 3.3.1 `apps/web/src/lib/auth.ts` 수정
  - [x] `CredentialsProvider` 추가
  - [x] `authorize()` 콜백 구현 (API 서버 `/api/auth/email/login` 호출)
  - [x] 이메일/비밀번호 검증 로직
  - [x] 기존 OAuth 설정 유지 (OCP)
- [x] 3.3.2 품질 검증
  - [x] `npm run lint` 통과 (apps/web)
  - [x] `npm run typecheck` 통과 (apps/web)

##### 3.4 로그인 통합 테스트

- [x] 3.4.1 기능 테스트
  - [x] 올바른 이메일/비밀번호로 로그인 성공 (200 OK)
  - [x] 잘못된 비밀번호로 로그인 실패 (401 Unauthorized)
  - [x] 존재하지 않는 이메일로 로그인 실패 (401 Unauthorized)
  - [x] NextAuth 세션 정상 작동 확인 (Docker 환경에서 정상 작동)
- [x] 3.4.2 전체 품질 검증
  - [x] `npm run lint` 통과 (packages/database, apps/api, apps/web)
  - [x] `npm run typecheck` 통과 (packages/database, apps/api, apps/web)
- [x] 3.4.3 CLAUDE.md 업데이트 및 Git 커밋
  - [x] CLAUDE.md에 Step 3 완료 기록
  - [x] `git add .`
  - [x] `git commit -m "feat: Step 3 - 로그인 API 및 NextAuth CredentialsProvider 구현"`
- [x] 3.4.4 구현계획서 체크박스 업데이트
  - [x] `docs/18-동네물어봐-이메일기반로그인시스템-구현계획서.md` Step 3 체크박스 모두 체크
  - [x] `git add .`
  - [x] `git commit -m "docs: Step 3 체크박스 업데이트"`

---

#### Step 4: 프론트엔드 - 회원가입 페이지 (2일)

**SOLID 원칙 적용**:

- **SRP**: Validation / API 호출 / UI 렌더링 분리
- **ISP**: 작은 컴포넌트로 분할

##### 4.1 Form Validation 훅 구현

- [ ] 4.1.1 `apps/web/src/hooks/useRegisterForm.ts` 생성
  - [ ] React Hook Form + Zod 통합
  - [ ] 실시간 검증 로직 (debounce 500ms)
  - [ ] 에러 메시지 한글화
- [ ] 4.1.2 필요한 패키지 설치
  - [ ] `npm install react-hook-form @hookform/resolvers`
- [ ] 4.1.3 품질 검증
  - [ ] `npm run lint` 통과 (apps/web)
  - [ ] `npm run typecheck` 통과 (apps/web)

##### 4.2 비밀번호 강도 표시 컴포넌트 (SRP)

- [ ] 4.2.1 `apps/web/src/components/auth/PasswordStrengthIndicator.tsx` 생성
  - [ ] 강도 계산 로직 (약함/보통/강함)
  - [ ] 시각적 표시 바 (Tailwind CSS)
  - [ ] shadcn/ui Progress 컴포넌트 활용
- [ ] 4.2.2 품질 검증
  - [ ] `npm run lint` 통과 (apps/web)
  - [ ] `npm run typecheck` 통과 (apps/web)

##### 4.3 회원가입 폼 컴포넌트

- [ ] 4.3.1 `apps/web/src/components/auth/RegisterForm.tsx` 생성
  - [ ] 이메일 입력 필드 (shadcn/ui Input)
  - [ ] 비밀번호 입력 필드 + 강도 표시
  - [ ] 비밀번호 확인 필드
  - [ ] 이름/닉네임 입력 필드
  - [ ] 이용약관 동의 체크박스
  - [ ] 제출 버튼 (로딩 상태 표시)
- [ ] 4.3.2 품질 검증
  - [ ] `npm run lint` 통과 (apps/web)
  - [ ] `npm run typecheck` 통과 (apps/web)

##### 4.4 회원가입 페이지

- [ ] 4.4.1 `apps/web/src/app/auth/signup/page.tsx` 생성
  - [ ] RegisterForm 컴포넌트 렌더링
  - [ ] API 호출 로직 (`/api/auth/register`)
  - [ ] 성공 시 로그인 페이지로 리다이렉트
  - [ ] 에러 처리 (toast 알림)
- [ ] 4.4.2 품질 검증
  - [ ] `npm run lint` 통과 (apps/web)
  - [ ] `npm run typecheck` 통과 (apps/web)

##### 4.5 UI/UX 테스트

- [ ] 4.5.1 수동 테스트
  - [ ] 모든 필드 검증 동작 확인
  - [ ] 비밀번호 강도 표시 정상 작동
  - [ ] 에러 메시지 한글 표시 확인
  - [ ] 로딩 상태 표시 확인
- [ ] 4.5.2 전체 품질 검증
  - [ ] `npm run lint` 통과 (apps/web)
  - [ ] `npm run typecheck` 통과 (apps/web)
- [ ] 4.5.3 CLAUDE.md 업데이트 및 Git 커밋
  - [ ] CLAUDE.md에 Step 4 완료 기록
  - [ ] `git add .`
  - [ ] `git commit -m "feat: Step 4 - 회원가입 페이지 UI 구현 (shadcn/ui)"`
- [ ] 4.5.4 구현계획서 체크박스 업데이트
  - [ ] `docs/18-동네물어봐-이메일기반로그인시스템-구현계획서.md` Step 4 체크박스 모두 체크
  - [ ] `git add .`
  - [ ] `git commit -m "docs: Step 4 체크박스 업데이트"`

---

#### Step 5: 프론트엔드 - 로그인 페이지 수정 (1일)

##### 5.1 이메일 로그인 폼 컴포넌트

- [ ] 5.1.1 `apps/web/src/components/auth/EmailLoginForm.tsx` 생성
  - [ ] 이메일 입력 필드 (shadcn/ui Input)
  - [ ] 비밀번호 입력 필드
  - [ ] 로그인 버튼
  - [ ] NextAuth `signIn("credentials")` 호출
- [ ] 5.1.2 품질 검증
  - [ ] `npm run lint` 통과 (apps/web)
  - [ ] `npm run typecheck` 통과 (apps/web)

##### 5.2 로그인 페이지 레이아웃 개선

- [ ] 5.2.1 `apps/web/src/app/auth/signin/page.tsx` 수정
  - [ ] EmailLoginForm 추가
  - [ ] 구분선 (`또는`) 추가
  - [ ] 기존 OAuth 버튼 유지
  - [ ] "이메일로 회원가입" 링크 추가
  - [ ] shadcn/ui 디자인 시스템 일관성 유지
- [ ] 5.2.2 품질 검증
  - [ ] `npm run lint` 통과 (apps/web)
  - [ ] `npm run typecheck` 통과 (apps/web)

##### 5.3 로그인 기능 테스트

- [ ] 5.3.1 수동 테스트
  - [ ] 이메일/비밀번호 로그인 성공
  - [ ] 잘못된 비밀번호 에러 표시
  - [ ] 세션 정상 생성 확인 (`/api/auth/session`)
  - [ ] OAuth 로그인 기존 동작 유지 확인
- [ ] 5.3.2 전체 품질 검증
  - [ ] `npm run lint` 통과 (apps/web)
  - [ ] `npm run typecheck` 통과 (apps/web)
- [ ] 5.3.3 CLAUDE.md 업데이트 및 Git 커밋
  - [ ] CLAUDE.md에 Step 5 완료 기록
  - [ ] `git add .`
  - [ ] `git commit -m "feat: Step 5 - 로그인 페이지 이메일 로그인 폼 추가"`
- [ ] 5.3.4 구현계획서 체크박스 업데이트
  - [ ] `docs/18-동네물어봐-이메일기반로그인시스템-구현계획서.md` Step 5 체크박스 모두 체크
  - [ ] `git add .`
  - [ ] `git commit -m "docs: Step 5 체크박스 업데이트"`

---

#### Step 6: 보안 강화 (1일)

##### 6.1 Rate Limiter 설정

- [ ] 6.1.1 `apps/api/src/middleware/rateLimiter.ts` 수정
  - [ ] `/api/auth/register`: 3회/시간
  - [ ] `/api/auth/login`: 5회/분
  - [ ] IP 기반 제한
- [ ] 6.1.2 라우터에 Rate Limiter 미들웨어 적용
- [ ] 6.1.3 품질 검증
  - [ ] `npm run lint` 통과 (apps/api)
  - [ ] `npm run typecheck` 통과 (apps/api)

##### 6.2 CSRF 보호 검증

- [ ] 6.2.1 NextAuth CSRF 토큰 확인
  - [ ] `NEXTAUTH_SECRET` 환경변수 설정 확인
  - [ ] CSRF 토큰 자동 검증 동작 확인
- [ ] 6.2.2 품질 검증
  - [ ] `npm run lint` 통과 (apps/web)
  - [ ] `npm run typecheck` 통과 (apps/web)

##### 6.3 환경변수 설정

- [ ] 6.3.1 `.env` 파일 업데이트
  - [ ] `PASSWORD_MIN_LENGTH=8` 추가
  - [ ] `PASSWORD_SALT_ROUNDS=10` 추가
  - [ ] `NEXTAUTH_SECRET` 32자 이상 랜덤 값 설정
- [ ] 6.3.2 `.env.example` 파일 업데이트
  - [ ] 새로운 환경변수 예시 추가
- [ ] 6.3.3 CLAUDE.md 업데이트 및 Git 커밋
  - [ ] CLAUDE.md에 Step 6 완료 기록
  - [ ] `git add .`
  - [ ] `git commit -m "feat: Step 6 - 보안 강화 (Rate Limiter, CSRF, 환경변수)"`
- [ ] 6.3.4 구현계획서 체크박스 업데이트
  - [ ] `docs/18-동네물어봐-이메일기반로그인시스템-구현계획서.md` Step 6 체크박스 모두 체크
  - [ ] `git add .`
  - [ ] `git commit -m "docs: Step 6 체크박스 업데이트"`

---

#### Step 7: E2E 테스트 (Playwright) (1일)

##### 7.1 회원가입 플로우 테스트

- [ ] 7.1.1 `apps/web/tests/auth/signup.e2e.test.ts` 생성
  - [ ] 정상 회원가입 시나리오
  - [ ] 중복 이메일 에러 시나리오
  - [ ] 약한 비밀번호 에러 시나리오
  - [ ] 폼 검증 에러 시나리오
- [ ] 7.1.2 테스트 실행
  - [ ] `npm run test:e2e` 통과

##### 7.2 로그인 플로우 테스트

- [ ] 7.2.1 `apps/web/tests/auth/login.e2e.test.ts` 생성
  - [ ] 이메일 로그인 성공 시나리오
  - [ ] 잘못된 비밀번호 시나리오
  - [ ] OAuth 로그인 기존 동작 유지 확인
- [ ] 7.2.2 테스트 실행
  - [ ] `npm run test:e2e` 통과

##### 7.3 통합 플로우 테스트

- [ ] 7.3.1 `apps/web/tests/auth/full-flow.e2e.test.ts` 생성
  - [ ] 회원가입 → 로그인 → 질문 작성 → 로그아웃
  - [ ] 세션 유지 확인 (7일 만료)
- [ ] 7.3.2 테스트 실행
  - [ ] `npm run test:e2e` 통과

##### 7.4 전체 품질 검증

- [ ] 7.4.1 모든 테스트 통과 확인
  - [ ] `npm run lint` 통과 (전체 워크스페이스)
  - [ ] `npm run typecheck` 통과 (전체 워크스페이스)
  - [ ] `npm run test:e2e` 통과
- [ ] 7.4.2 CLAUDE.md 업데이트 및 Git 커밋
  - [ ] CLAUDE.md에 Step 7 완료 기록
  - [ ] `git add .`
  - [ ] `git commit -m "test: Step 7 - E2E 테스트 구현 (Playwright)"`
- [ ] 7.4.3 구현계획서 체크박스 업데이트
  - [ ] `docs/18-동네물어봐-이메일기반로그인시스템-구현계획서.md` Step 7 체크박스 모두 체크
  - [ ] `git add .`
  - [ ] `git commit -m "docs: Step 7 체크박스 업데이트"`

---

#### Step 8: 문서화 및 배포 준비 (0.5일)

##### 8.1 API 문서 업데이트

- [ ] 8.1.1 `docs/api/auth.md` 생성
  - [ ] `POST /api/auth/register` 명세
  - [ ] `POST /api/auth/login` 명세
  - [ ] 요청/응답 예시
  - [ ] 에러 코드 정의

##### 8.2 CLAUDE.md 업데이트 및 Git 커밋

- [ ] 8.2.1 Phase 1 완료 상태 업데이트
  - [ ] "Phase 1.14: 이메일 기반 로그인 시스템" 추가
  - [ ] 구현 내용 요약
  - [ ] 테스트 결과 기록
- [ ] 8.2.2 Git 커밋
  - [ ] `git add .`
  - [ ] `git commit -m "docs: Phase 1.14 이메일 로그인 시스템 완료"`

##### 8.3 최종 품질 검증 및 Git 태그

- [ ] 8.3.1 전체 프로젝트 검증
  - [ ] `npm run lint` 통과 (전체 워크스페이스)
  - [ ] `npm run typecheck` 통과 (전체 워크스페이스)
  - [ ] `npm run test:e2e` 통과
  - [ ] 로컬 환경 수동 테스트
- [ ] 8.3.2 Git 태그 생성
  - [ ] `git tag -a v1.14-email-auth -m "Phase 1.14: 이메일 기반 로그인 시스템 완료"`
  - [ ] `git push origin main --tags`
- [ ] 8.3.3 구현계획서 체크박스 최종 업데이트
  - [ ] `docs/18-동네물어봐-이메일기반로그인시스템-구현계획서.md` Step 8 체크박스 모두 체크
  - [ ] `git add .`
  - [ ] `git commit -m "docs: Step 8 체크박스 업데이트 - Phase 1.14 완료"`

---

### 4.2 Phase 2: 소셜 네트워크 통합 (추후 작업)

#### Step 9: 계정 연동 시스템 (미정)

- [ ] 9.1 Account 모델 추가
  - [ ] Prisma schema에 `Account` 모델 정의
  - [ ] NextAuth Account 테이블 연동
- [ ] 9.2 계정 연동 로직
  - [ ] 이메일 기반 계정 통합 전략 구현
  - [ ] 비밀번호 재확인 후 연동 UI
- [ ] 9.3 품질 검증
  - [ ] `npm run lint` 통과
  - [ ] `npm run typecheck` 통과
  - [ ] E2E 테스트 추가

---

### 4.3 예상 총 소요 시간

- **Step 1**: 1일 (데이터베이스 준비)
- **Step 2**: 2일 (백엔드 회원가입)
- **Step 3**: 1일 (백엔드 로그인)
- **Step 4**: 2일 (프론트엔드 회원가입)
- **Step 5**: 1일 (프론트엔드 로그인)
- **Step 6**: 1일 (보안 강화)
- **Step 7**: 1일 (E2E 테스트)
- **Step 8**: 0.5일 (문서화)
- **총계**: **9.5일** (이메일 인증 미포함)
- **이메일 인증 포함 시**: +1일 = **10.5일**

---

## 5. 품질 관리 가이드

### 5.1 각 Step 완료 조건

모든 Step은 다음 조건을 만족해야 체크박스 체크:

1. ✅ 기능 구현 완료
2. ✅ `npm run lint` 통과 (해당 워크스페이스)
3. ✅ `npm run typecheck` 통과 (해당 워크스페이스)
4. ✅ 관련 테스트 통과 (있는 경우)

### 5.2 코드 품질 기준

- **Lint**: ESLint 규칙 100% 준수
- **TypeCheck**: TypeScript 컴파일 에러 0개
- **Test Coverage**: E2E 테스트 주요 플로우 100% 커버
- **SOLID 원칙**: 각 클래스/모듈은 단일 책임만 가짐

### 5.3 최종 배포 조건

- [ ] 전체 Step 1~8 체크박스 100% 체크
- [ ] 전체 워크스페이스 lint/typecheck 통과
- [ ] E2E 테스트 100% 통과
- [ ] 수동 테스트 시나리오 완료
- [ ] CLAUDE.md 업데이트 완료

---

## 6. 환경 변수

### 6.1 백엔드 (`.env`)

```bash
# 기존 NextAuth 설정
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-super-secret-key-min-32-characters

# 비밀번호 정책
PASSWORD_MIN_LENGTH=8
PASSWORD_SALT_ROUNDS=10
```

### 6.2 프론트엔드 (`.env.local`)

```bash
# 기존 API URL
NEXT_PUBLIC_API_URL=http://localhost:4000/api
```

---

## 7. 위험 요소 및 대응 방안

### 7.1 기술적 위험

| 위험 요소                     | 영향도 | 대응 방안                            |
| ----------------------------- | ------ | ------------------------------------ |
| 기존 OAuth 사용자 데이터 손실 | 높음   | 마이그레이션 전 DB 백업 필수         |
| NextAuth 설정 충돌            | 중간   | Credentials + OAuth 동시 지원 테스트 |
| 비밀번호 해싱 성능 저하       | 낮음   | bcrypt saltRounds 조정 (10 권장)     |

### 7.2 보안 위험

| 위험 요소                      | 영향도 | 대응 방안                             |
| ------------------------------ | ------ | ------------------------------------- |
| 무차별 대입 공격 (Brute Force) | 높음   | Rate Limiter + CAPTCHA (5회 실패 시)  |
| 이메일 인증 우회               | 중간   | `emailVerified` null 체크 강제        |
| SQL Injection                  | 낮음   | Prisma ORM 사용 (Prepared Statements) |

---

## 8. 롤백 계획

### 8.1 데이터베이스 롤백

```bash
# 마이그레이션 전 백업
npx prisma db pull --schema=schema.backup.prisma

# 롤백 실행
npx prisma migrate reset --force
npx prisma migrate deploy --schema=schema.backup.prisma
```

### 8.2 코드 롤백

```bash
# Git 태그 생성
git tag -a v1.12-before-email-auth -m "Phase 1.12 안정 버전"

# 롤백 시
git checkout v1.12-before-email-auth
```

---

## 9. 참고 자료

- [NextAuth.js Credentials Provider](https://next-auth.js.org/providers/credentials)
- [Prisma Schema Reference](https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference)
- [bcrypt.js Documentation](https://github.com/dcodeIO/bcrypt.js)
- [OWASP Password Guidelines](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
- [SOLID Principles](https://en.wikipedia.org/wiki/SOLID)

---

## 10. 결론

### 10.1 구현 우선순위

1. **Phase 1 필수**: 이메일 회원가입 + 로그인 (Step 1~8)
2. **Phase 1 권장**: 이메일 인증 (옵션)
3. **Phase 2**: 계정 연동 시스템 (Step 9)

### 10.2 승인 대기 사항

- [ ] 데이터베이스 스키마 변경 승인
- [ ] SOLID 원칙 적용 방식 승인
- [ ] 각 Step별 체크박스 관리 방식 승인
- [ ] 구현 시작 승인

---

**작성자**: Claude Code
**설계 원칙**: SOLID 준수
**품질 관리**: 각 단계별 lint + typecheck 필수
**다음 단계**: 승인 후 Step 1 (데이터베이스 준비) 착수
